# 01 计算机网络基础 
> 计算机网络学习的核心内容就是网络协议的学习  

## 1. 网络层次划分  

![1538030296-7490-20150904094019903-1923900106](https://user-images.githubusercontent.com/116731168/211349440-3848a57b-62c3-4b5c-b4ff-9bb4d54b03f6.jpg)
*OSI/RM: Open System Interconnection/Reference Model 

## 2. OSI七层网络模型 

### 1) 物理层（Physical Layer） 
> 确保原始的数据可在各种物理媒体上传输  

中继器和集线器  

### 2) 数据链路层 (Data Link Layer) 
> 该层的作用包括：物理地址寻址、数据的成帧、流量控制、数据的检错、重发等  

1. 数据链路层在不可靠的物理介质上为网络层提供可靠的数据传输 
2. 基本数据单位为帧（frame） 
3. 主要的协议：以太网协议 
4. 两个重要设备：网桥和交换机 

### 3) 网络层（Network Layer） 
> 实现两个端系统之间的数据透明传送，具体功能包括寻址和路由选择、连接的建立、保持和终止等，使得传输层不需要了解网络中的数据传输和交换技术  

1. 负责对子网间的数据包进行路由选择。此外，网络层还可以实现拥塞控制、网际互连等功能  
2. 基本数据单位为IP数据包  
3. 包含的主要协议  
> IP协议 （Internet Protocol）  
> ICMP协议 （Internet Control Message Protocol）  
> ARP协议 （Address Resolution Protocol）  
> RARP协议 （Reverse Address Resolution Protocol）  
4. 重要设备：路由器  

### 4) 传输层（Transport Layer)  
> 首个端到端，即主机到主机的层次。负责将上层数据分段并提供端到端的传输。此外，传输层还要处理端到端的差错控制和流量控制问题。  
> 网络层只是根据网络地址将源结点发出的数据包传送到目的结点，而传输层则负责将数据可靠地传送到相应的端口  

1. 包含的主要协议  
> TCP协议（Transmission Control Protocol）  
> UDP协议（User Datagram Protocol）  
2. 重要设备：网关  

### 5) 会话层  
> 管理主机之间的会化进程，还利用在数据中插入校验点来实现数据的同步  

### 6) 表示层  
> 对上层数据或信息进行变换以保证一个主机应用层信息可以被另一个主机的应用程序理解。包括数据的加密、压缩、格式转换等  

### 7) 应用层  
> 为操作系统或网络应用程序提供访问网络服务的接口  

以上三层的重点：
1. 数据传输基本单位为报文  
2. 包含的主要协议：FTP（文件传送协议），Telnet（远程登陆协议），DNS（域名解析协议），SMTP（邮件传送协议），POP3协议（邮局协议），HTTP协议（Hyper Text Transfer Protocol）  

## 3. IP地址  
IP地址由网络号（包括子网号）和主机号组成  
### 1) 网络地址  
> 网络地址的主机号全为0，网络地址代表着整个网络  

### 2) 广播地址  
> 广播地址通常称为直接广播地址，是为了区分*受限广播地址*  
广播地址与网络地址的主机号正好相反，广播地址中，主机号为全1。当向某个网络的广播地址发送消息时，该网络内的所有主机都能收到该广播消息  

### 3) 组播地址  
D类地址就是组播地址  
> A类地址以0开头，第一个字节作为网络号，地址范围为：0.0.0.0 ~ 127.255.255.255    
> B类地址以10开头，前两个字节作为网络号，地址范围为：128.0.0.0 ~ 191.255.255.255    
> C类地址以110开头，前三个字节作为网络号，地址范围为：192.0.0.0 ~ 223.255.255.255    
> D类地址以1110开头，地址范围为：224.0.0.0 ~ 239.255.255.255，D类地址作为组播地址（一对多通信）   
> E类地址以1111开头，地址范围为：240.0.0.0 ~ 255.255.255.255，E类地址为保留地址，供以后使用  

*只有A，B，C有网络号和主机号之分，D和E没有划分网络号和主机号  

### 4) 255.255.255.255  
> 该IP地址指的是受限的广播地址  
受限广播地址只能用于本地网络，路由器不会转发以受限广播地址为目标地址的消息；一般广播地址既可在本地广播，也可跨网段广播  

### 5) 0.0.0.0  
> 常用于寻找自己的IP地址  

### 6) 回环地址  
> 127.0.0.0/8 被用作回环地址，回环地址表示本机的地址，常用于对本机的测试，用的最多的是127.0.0.1  

## 4. 子网掩码及网络划分  
  
## 5. ARP/RARP协议  
> Address Resolution Protocol，是根据IP地址获取物理地址的一个TCP/IP协议  
> 主机发送信息时将包含目标IP地址的ARP请求广播到网络上的所有主机，并接受返回信息，一次确定目标的物理地址  
> 收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源   
**ARP命令可用于查询本机ARP缓存中IP地址和MAC地址的对应关系、添加或删除静态对应关系**  

## 6. 路由选择协议  
常见的路由选择协议有：
**RIP协议**：底层是贝尔曼福特算法，度量指标是跳数，最大跳数是15跳，如果大于15跳，就会丢弃数据包  
**OSPF协议**：Open Shortest Path First 开放式最短路径优先，底层是迪杰斯特拉算法，度量标准是带宽和延迟  

## 7. TCP/IP协议  
> 传输层的TCP负责发现传输的问题，一有问题就发出信号，要求重新传输，知道所有数据安全正确地传输到目的地  
> 网络层的IP协议是给每一台联网设备规定一个地址  

IP层接受由更低层（网络接口层例如以太网设备驱动程序）发来的数据包，并把该数据包发送到更高层——TCP或UDP层；  
相反，IP层也把从TCP或UDP层接受来的数据包传送到更低层  
IP数据包是不可靠的，因为IP并没有做任何事情来确认数据包是否按顺序发送或者有没有被破坏。  

TCP是面向连接的通信协议，所以只能用于端到端的通讯。  
TCP提供的是一种可靠的数据流服务，采用**带重传的肯定确认**技术来实现传输的可靠性。  
TCP还采用一种称为”滑动窗口“的方式进行流量控制，所谓窗口实际表示接受能力，用以限制发送方的发送速度  

**TCP报文首部格式**  
![1538030297-3779-20150904110054856-961661137](https://user-images.githubusercontent.com/116731168/211535060-b421551c-06db-4563-a18f-880eb6a26077.png)

**TCP协议的三次握手和四次挥手**  
![1538030297-7824-20150904110008388-1768388886](https://user-images.githubusercontent.com/116731168/211535202-016e9b09-62c6-4bc8-963d-47c7cc07e2c0.jpg)

* **SYN**：请求同步标志，**ACK**：确认标志，**FIN**：结束标志 
* **TCP连接建立过程**：
> 首先Client发送连接请求报文，Server接受连接后回复ACK报文，并为这次连接分配资源。Client接收到ACK后也向Server发送ACK，并分配资源  

* **TCP连接断开过程**：  
> Client发起中断连接请求，也就是发送FIN，意味着“Client没有数据要发给Server了，但如果Server还有数据没有发送完成，则不必着急关闭Socket”  
> Server收到FIN后，先发送ACK，即表示“中断请求已收到，但Server还没准备好，请继续等待消息  
> 此时Client进入FIN_WAIT状态
> 当Server确定数据已发送完成，则向Client发送FIN
> 当Client收到FIN后，知道可以关闭连接了，但还是不相信网络，所以发送ACK后进入TIME_WAIT状态，如果Server没收到ACK可以重传  
> Server收到ACK后，断开连接  
> Client等待2MSL后依然没有收到回复，则证明Server已正常关闭，那Client也可以关闭连接  

## 8. UDP协议  
> 用户数据报协议，是面向无连接的通讯协议，由于通讯不需要连接，所以可以实现广播发送  
> UDP通讯时不需要接收方确认，属于不可靠传输，可能会出现丢包，实际应用中要求程序员编程验证  
> 主要用于那些面向查询——应答服务，例如NFS  

使用UDP协议包括：TFTP（简单文件传输协议）、SNMP（简单网络管理协议）、DNS、NFS、BOOTP  

## 9. DNS协议  
> Domain Name System，用于命名组织到域层次结构中的计算机和网络服务，简单理解为将URL转换为IP地址  

## 10. NAT协议  
> Network Address Translation属接入广域网（WAN）技术，是一种将私有地址转化为合法IP地址的转换技术  
> 既解决了IP地址不足的问题，还能够有效避免来自网络外部的攻击，隐藏并保护网络内部的计算机  

## 11. HTTP协议  
**HTTP协议包括哪些请求**：  
* Get：请求读取由URL所标志的信息  
* POST：给服务器添加信息（如注释）
* PUT：在给定的URL下存储一个文档  
* DELETE：删除给定的URL所标志的资源

# 02 套接字Socket是什么  
> socket的原意是“插座”，它是计算机之间进行通信的一种约定或一种方式。  
> 为了与远程计算机进行数据传输，需要连接到因特网，而socket就是用来连接到因特网的工具  

## UNIX/Linux中socket是什么？  
> 在UNIX/Linux系统中，为了统一对各种硬件的操作，简化接口，不同的硬件设备也都被看成一个文件。对这些文件的操作，等同于对磁盘上普通文件的操作  

为了表示和区分已经打开的文件，UNIX/Linux会给每个文件分配一个ID，这个ID就是一个整数，被称为**文件描述符（File Descriptor）**。  
例如：
* 通常用0表示标准输入文件（stdin），对应的硬件设备就是键盘  
* 通常用1表示标准输出文件（stdout），对应的硬件设备就是显示器  
*网络连接也是一个文件，它也有文件描述符！！！*  

因此，只要用socket()创建了网络连接，剩下的就是文件操作了。

# 03 socket(int domain, int type, int protocol) -> int  
* *domain*：IP地址类型，AF_INET表示IPv4，AF_INET表示IPv6  
* *type*：数据传输方式，SOCK_STREAM表示流格式、面向连接，多用于TCP。SOCK_DGRAM表示数据报格式、无连接，多用于UDP  
* *protocol*：0表示根据前面两个参数自动推导协议类型，设置为IPPROTO_TCP和IPPROTO_UDP  

# 04 大致步骤  
> 对于客户端，服务器存在的唯一标识是一个IP地址和端口，此时我们需要将这个套接字绑定到一个IP地址和端口上。  

* 首先，创建一个*sockaddr_in*结构体  
* 然后使用```bzero```初始化这个结构体，接着设置地址族、IP地址和端口，然后将socket地址与文件描述符绑定  
* 最后我们需要使用```listen```监听这个socket端口  
* 要接受一个客户端连接，需要使用```accept```。对于每一个客户端，我们在接受连接时需要保存客户端的socket地址信息  
* 另外，```accept```会阻塞当前程序，知道有一个客户端socket被接受后程序才会往下运行  









